<html>
<head>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style type="text/css">
        #mynetwork {
            width: 1800px;
            height: 1000px;
            border: 1px solid lightgray;
        }
    </style>
</head>
<body>
    <div id="mynetwork"></div>
    <h2 id="eventSpanHeading"></h2>
    <pre id="eventSpanContent"></pre>
</body>
<script type="text/javascript">
const description_regex = /<p id="mwCw">.*?<\/p>/i;
const plain_text_regex = /<[^>]+>/g;

async function a(site_name) {
    try {
        var b = await fetch('https://de.wikipedia.org/api/rest_v1/page/html/' + site_name)
            .then(response => response.text());
        
        // Match the paragraph with id "mwCw"
        const matchedParagraph = b.match(description_regex);
        
        if (matchedParagraph && matchedParagraph[0]) {
            // Remove HTML tags from the matched paragraph
            const plainText = matchedParagraph[0].replace(plain_text_regex, '');
            return plainText;
        } else {
            console.log('No matching paragraph found');
            return null;
        }
    } catch (error) {
        console.error('Error fetching or processing data:', error);
        return null;
    }
}

var nodes = new vis.DataSet([
  { id: "Angela_Merkel", label: "Node 1", title: "wiki_text" },
  { id: 2, label: "Node 2", title: "I have a popup!" },
  { id: 3, label: "Node 3", title: "I have a popup!" },
  { id: 4, label: "Node 4", title: "I have a popup!" },
  { id: 5, label: "Node 5", title: "I have a popup!" },
]);

var edges = new vis.DataSet([
  { from: "Angela_Merkel", to: 3 },
  { from: "Angela_Merkel", to: 2 },
  { from: 2, to: 4 },
  { from: 2, to: 5 },
]);

var container = document.getElementById("mynetwork");
var data = {
  nodes: nodes,
  edges: edges,
};

var options = {
  interaction: { hover: true },
  manipulation: {
    enabled: true,
  },
};

var network = new vis.Network(container, data, options);

var position_offest_x = 200;
var position_offest_y = -150;
var network_container = document.getElementsByClassName("vis-network")[0];
var new_div = document.createElement("div");

new_div.style = "width: 500px; height: 300px; background-color: white;";
new_div.innerHTML = `
    <h1 style="color:black;border-bottom:1px solid #a2a9b1; margin: 0 0 0 0.5em; font-size: 1.8rem; font-weight: normal;">Slowakischer Nationalaufstand</h1>
    <div style="display: flex; flex-direction: row; height: 90%;">
        <p id="nodeContent" style="font-family: sans-serif; margin: 0.5em 1em 1em 1em; overflow-y: scroll;"></p>
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2e/DIAS_1942_photo.jpg/1280px-DIAS_1942_photo.jpg" style="align-self:flex-start; max-height: 98%; max-width: 50%;">
    </div>
`;
new_div.style.position = "absolute";
new_div.style.visibility = "hidden";
network_container.appendChild(new_div);
var attached_node;

network.on("dragStart", function (params) {
    params.event = "[original event]";
    console.log("dragStart Event:", params);
    console.log("dragStart event, getNodeAt returns: " + this.getNodeAt(params.pointer.DOM));
});

network.on("dragging", function (params) {
    if (new_div.style.visibility == "visible") {
        const viewport_pos = network.getViewPosition();
        const node_pos = network.getPosition(attached_node);
        new_div.style.left = ((node_pos.x - viewport_pos.x + position_offest_x) * network.getScale() + 900) + 'px';
        new_div.style.top = ((node_pos.y - viewport_pos.y + position_offest_y) * network.getScale() + 500) + 'px';
    }
});

network.on("dragEnd", function (params) {
    params.event = "[original event]";
    document.getElementById("eventSpanHeading").innerText = "dragEnd event:";
    document.getElementById("eventSpanContent").innerText = JSON.stringify(params, null, 4);
    console.log("dragEnd Event:", params);
    console.log("dragEnd event, getNodeAt returns: " + this.getNodeAt(params.pointer.DOM));
});

network.on("zoom", function (params) {
    new_div.style.width = (500 * network.getScale()).toString() + "px";
    new_div.style.height = (300 * network.getScale()).toString() + "px";
    const node_pos = network.getPosition(attached_node);
    const viewport_pos = network.getViewPosition();
    new_div.style.left = ((node_pos.x - viewport_pos.x + position_offest_x) * network.getScale() + 900) + 'px';
    new_div.style.top = ((node_pos.y - viewport_pos.y + position_offest_y) * network.getScale() + 500) + 'px';
    console.log(new_div.style);
    document.getElementById("eventSpanHeading").innerText = "zoom event:";
    document.getElementById("eventSpanContent").innerText = JSON.stringify(params, null, 4);
});

network.on("select", function (params) {
    console.log("select Event:", params);
});

network.on("selectNode", function (params) {
    if (params.nodes[0]) {
        a(params.nodes[0]).then(plainText => {
            if (plainText) {
                document.getElementById("nodeContent").innerText = plainText;
                new_div.style.visibility = "visible";
                attached_node = params.nodes[0];
                const node_pos = network.getPosition(attached_node);
                const viewport_pos = network.getViewPosition();
                new_div.style.left = ((node_pos.x - viewport_pos.x + position_offest_x) * network.getScale() + 900) + 'px';
                new_div.style.top = ((node_pos.y - viewport_pos.y + position_offest_y) * network.getScale() + 500) + 'px';
            } else {
                console.log('No content available for this node');
            }
        }).catch(error => {
            console.error('Error fetching or processing data:', error);
        });
    }
    console.log("selectNode Event:", params);
});

network.on("selectEdge", function (params) {
    console.log("selectEdge Event:", params);
});

network.on("deselectNode", function (params) {
    new_div.style.visibility = "hidden";
    console.log("deselectNode Event:", params);
});

network.on("deselectEdge", function (params) {
    console.log("deselectEdge Event:", params);
});

network.on("hoverNode", function (params) {
    console.log("hoverNode Event:", params);
});

network.on("hoverEdge", function (params) {
    console.log("hoverEdge Event:", params);
});

network.on("blurNode", function (params) {
    console.log("blurNode Event:", params);
});

network.on("blurEdge", function (params) {
    console.log("blurEdge Event:", params);
});

</script>
</html>
